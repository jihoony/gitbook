# MySQL Group Replication Requirements

## 20.3.1 Group Replication Requirements

* [Infrastructure](mysql-group-replication-requirements.md#infrastructure)
* [Server Instance Configuration](mysql-group-replication-requirements.md#server-instance-configuration)

Server instances that you want to use for Group Replication must satisfy the following requirements.



### **Infrastructure**

*   **InnoDB Storage Engine.**  Data must be stored in the [`InnoDB`](https://dev.mysql.com/doc/refman/8.3/en/innodb-storage-engine.html) transactional storage engine. Transactions are executed optimistically and then, at commit time, are checked for conflicts. If there are conflicts, in order to maintain consistency across the group, some transactions are rolled back. This means that a transactional storage engine is required. Moreover, [`InnoDB`](https://dev.mysql.com/doc/refman/8.3/en/innodb-storage-engine.html) provides some additional functionality that enables better management and handling of conflicts when operating together with Group Replication. The use of other storage engines, including the temporary [`MEMORY`](https://dev.mysql.com/doc/refman/8.3/en/memory-storage-engine.html) storage engine, might cause errors in Group Replication. Convert any tables in other storage engines to use [`InnoDB`](https://dev.mysql.com/doc/refman/8.3/en/innodb-storage-engine.html) before using the instance with Group Replication. You can prevent the use of other storage engines by setting the[`disabled_storage_engines`](https://dev.mysql.com/doc/refman/8.3/en/server-system-variables.html#sysvar\_disabled\_storage\_engines) system variable on group members, for example:

    ```ini
    disabled_storage_engines="MyISAM,BLACKHOLE,FEDERATED,ARCHIVE,MEMORY"
    ```
* **Primary Keys.**  Every table that is to be replicated by the group must have a defined primary key, or primary key equivalent where the equivalent is a non-null unique key. Such keys are required as a unique identifier for every row within a table, enabling the system to determine which transactions conflict by identifying exactly which rows each transaction has modified. Group Replication has its own built-in set of checks for primary keys or primary key equivalents, and does not use the checks carried out by the [`sql_require_primary_key`](https://dev.mysql.com/doc/refman/8.3/en/server-system-variables.html#sysvar\_sql\_require\_primary\_key) system variable. You may set `sql_require_primary_key=ON` for a server instance where Group Replication is running, and you may set the `REQUIRE_TABLE_PRIMARY_KEY_CHECK` option of the [`CHANGE REPLICATION SOURCE TO`](https://dev.mysql.com/doc/refman/8.3/en/change-replication-source-to.html) statement to `ON` for a Group Replication channel. However, be aware that you might find some transactions that are permitted under Group Replication's built-in checks are not permitted under the checks carried out when you set `sql_require_primary_key=ON` or `REQUIRE_TABLE_PRIMARY_KEY_CHECK=ON`.
*   **Network Performance.** MySQL Group Replication is designed to be deployed in a cluster environment where server instances are very close to each other. The performance and stability of a group can be impacted by both network latency and network bandwidth. Bi-directional communication must be maintained at all times between all group members. If either inbound or outbound communication is blocked for a server instance (for example, by a firewall, or by connectivity issues), the member cannot function in the group, and the group members (including the member with issues) might not be able to report the correct member status for the affected server instance.

    You can use a network infrastructure based on IPv4, IPv6, or a mix of the two, for TCP communication between remote Group Replication servers. There is also nothing preventing Group Replication from operating over a virtual private network (VPN).

    Where Group Replication server instances are co-located and share a local group communication engine (XCom) instance, a dedicated input channel with lower overhead is used for communication where possible instead of the TCP socket. For certain Group Replication tasks that require communication between remote XCom instances, such as joining a group, the TCP network is still used, so network performance influences the group's performance.



### **Server Instance Configuration**

The following options must be configured as shown on server instances that are members of a group.

* **Unique Server Identifier.**  Use the [`server_id`](https://dev.mysql.com/doc/refman/8.3/en/replication-options.html#sysvar\_server\_id) system variable to configure the server with a unique server ID, as required for all servers in replication topologies. The server ID must be a positive integer between 1 and (232)−1, and it must be different from every other server ID in use by any other server in the replication topology.
* **Binary Log Active.**  In MySQL 8.3, binary logging is enabled by default. You can optionally specify the names of the binary log files using [`--log-bin[=log_file_name]`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-binary-log.html#sysvar\_log\_bin). Group Replication replicates the binary log's contents, therefore the binary log needs to be on for it to operate. See [Section 7.4.4, “The Binary Log”](https://dev.mysql.com/doc/refman/8.3/en/binary-log.html).
* **Replica Updates Logged.**  Set [`log_replica_updates=ON`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-binary-log.html#sysvar\_log\_replica\_updates) if it is not already enabled. (In MySQL 8.3, this is the default.) Group members need to log transactions that are received from their donors at joining time and applied through the replication applier, and to log all transactions that they receive and apply from the group. This enables Group Replication to carry out distributed recovery by state transfer from an existing group member's binary log.
* **Binary Log Row Format.**  Set [`binlog_format=ROW`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-binary-log.html#sysvar\_binlog\_format) if necessary; in MySQL 8.3, this is the default. Group Replication relies on the row-based replication format to propagate changes consistently among the servers in the group, and extract the necessary information to detect conflicts among transactions that execute concurrently in different servers in the group. The setting for `REQUIRE_ROW_FORMAT` is automatically added to Group Replication's channels to enforce the use of row-based replication when the transactions are applied. See [Section 19.2.1, “Replication Formats”](https://dev.mysql.com/doc/refman/8.3/en/replication-formats.html) and [Section 19.3.3, “Replication Privilege Checks”](https://dev.mysql.com/doc/refman/8.3/en/replication-privilege-checks.html).
* **Global Transaction Identifiers On.**  Set [`gtid_mode=ON`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-gtids.html#sysvar\_gtid\_mode) and [`enforce_gtid_consistency=ON`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-gtids.html#sysvar\_enforce\_gtid\_consistency). These settings are not the defaults. GTID-based replication is required for Group Replication, which uses global transaction identifiers to track the transactions that have been committed on every server instance in the group. See [Section 19.1.3, “Replication with Global Transaction Identifiers”](https://dev.mysql.com/doc/refman/8.3/en/replication-gtids.html).
* **Default Table Encryption.**  Set [`default_table_encryption`](https://dev.mysql.com/doc/refman/8.3/en/server-system-variables.html#sysvar\_default\_table\_encryption) to the same value on all group members. Default schema and tablespace encryption can be either enabled (`ON`) or disabled (`OFF`, the default) as long as the setting is the same on all members.
* **Lower Case Table Names.**  Set [`lower_case_table_names`](https://dev.mysql.com/doc/refman/8.3/en/server-system-variables.html#sysvar\_lower\_case\_table\_names) to the same value on all group members. A setting of 1 is correct for the use of the [`InnoDB`](https://dev.mysql.com/doc/refman/8.3/en/innodb-storage-engine.html) storage engine, which is required for Group Replication. Note that this setting is not the default on all platforms.
*   **Binary Log Dependency Tracking.**  Setting [`binlog_transaction_dependency_tracking`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-binary-log.html#sysvar\_binlog\_transaction\_dependency\_tracking) to `WRITESET` can improve performance for a group member, depending on the group's workload (in MySQL 8.3 and later, this is the default). While Group Replication carries out its own parallelization after certification when applying transactions from the relay log, independently of any value set for `binlog_transaction_dependency_tracking`, this value does affect how transactions are written to the binary logs on Group Replication members. The dependency information in those logs is used to assist the process of state transfer for distributed recovery from a donor's binary log, which takes place whenever a member joins or rejoins the group.

    Note

    When [`replica_preserve_commit_order`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-replica.html#sysvar\_replica\_preserve\_commit\_order) is `ON`, setting `binlog_transaction_dependency_tracking` to `WRITESET` has the same effect as setting it to `WRITESET_SESSION`.
*   **Multithreaded Appliers.**  Group Replication members can be configured as multithreaded replicas, enabling transactions to be applied in parallel. All replicas are configured as multithreaded by default. A nonzero value for [`replica_parallel_workers`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-replica.html#sysvar\_replica\_parallel\_workers) enables the multithreaded applier on the member. The default is 4 parallel applier threads; up to 1024 parallel applier threads can be specified.

    Setting [`replica_parallel_workers=0`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-replica.html#sysvar\_replica\_parallel\_workers) disables parallel execution and gives the replica a single applier thread and no coordinator thread. With that setting, the [`replica_parallel_type`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-replica.html#sysvar\_replica\_parallel\_type) and [`replica_preserve_commit_order`](https://dev.mysql.com/doc/refman/8.3/en/replication-options-replica.html#sysvar\_replica\_preserve\_commit\_order) options have no effect and are ignored. If parallel execution is disabled when GTIDs are in use on a replica, the replica actually uses one parallel worker, to take advantage of the method for retrying transactions without accessing the file positions. However, this behavior does not change anything for the user.
*   **Detached XA transactions.**  MySQL 8.3 and later supports detached XA transactions. A detached transaction is one which, once prepared, is no longer connected to the current session. This happens automatically as part of executing [`XA PREPARE`](https://dev.mysql.com/doc/refman/8.3/en/xa-statements.html). The prepared XA transaction can be committed or rolled back by another connection, and the current session can then initiate another XA transaction or local transaction without waiting for the transaction that was just prepared to complete.

    When detached XA transaction support is enabled ([`xa_detach_on_prepare = ON`](https://dev.mysql.com/doc/refman/8.3/en/server-system-variables.html#sysvar\_xa\_detach\_on\_prepare)) it is possible for any connection to this server to list (using [`XA RECOVER`](https://dev.mysql.com/doc/refman/8.3/en/xa-statements.html)), roll back, or commit any prepared XA transaction. In addition, you cannot use temporary tables within detached XA transactions.

    You can disable support for detached XA transactions by setting [`xa_detach_on_prepare`](https://dev.mysql.com/doc/refman/8.3/en/server-system-variables.html#sysvar\_xa\_detach\_on\_prepare) to `OFF`, but this is not recommended. In particular, if this server is being set up as an instance in MySQL group replication, you should leave this variable set to its default value (`ON`).

    See [Section 15.3.8.2, “XA Transaction States”](https://dev.mysql.com/doc/refman/8.3/en/xa-states.html), for more information.



{% embed url="https://dev.mysql.com/doc/refman/8.3/en/group-replication-requirements.html" %}
